<style>
  .delete-btn:hover{
    transform: scale(1.3,1.3)
  }

  /* Styles for the overlay */
  .modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
  z-index: 1000; /* Adjust the z-index as needed to ensure it's above other content */
  }

  /* Styles for the modal */
  .modal {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  padding: 20px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
  z-index: 1001; /* Make it appear on top of the overlay */
  width: 60%;
  height: 80%;
  border-radius: 15px;
  overflow: hidden;
  
  }

  .scrollable {
            height: 50vh; /* Set a specific height to make it scrollable */
            overflow-y: auto; /* Add vertical scrollbar if needed */
            margin-top: 1em;
            margin-bottom: 5em;
            border: 1px solid lightgray;
            border-radius: 5px;
            padding: 1em;
        }

</style>

<div class="ml-5" id="datasets-list">
  <h2 class="text-center">Saved Datasets</h2>
    <input type="text" id="search-bar" placeholder="Search Datasets" onkeyup="filterDatasets()">
      <br><br>
        <div class="scrollable">
          <% if @datasets.present? %>
            <% @datasets.each do |dataset| %>
              <div class="dataset-item ">
                  <span style="color: var(--warning)">â˜…</span>
                  <a href='<%= dataset.url %>' target="_blank" rel="nofollow"><%= dataset.title %></a>
                  <button class="delete-btn" 
                          onclick="deleteDataset('<%= dataset.dataset_id %>')" style="margin-left:1em; cursor:pointer">
                  <svg xmlns="http://www.w3.org/2000/svg" height="0.75em" viewBox="0 0 448 512">
                  <style>svg { fill:#cb3c29 }</style>
                  <path d="M170.5 51.6L151.5 80h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6H177.1c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6L354.2 80H368h48 8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8V432c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128H24c-13.3 0-24-10.7-24-24S10.7 80 24 80h8H80 93.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128V432c0 17.7 14.3 32 32 32H336c17.7 0 32-14.3 32-32V128H80zm80 64V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16z"/>
                  </svg>
                  </button>
                  <span id="url" <%= "hidden" %>><%= dataset.url%></span>
                  <br><br>
              </div>
          <% end %>
          <% end %>
        </div>
</div>

<script>
  function filterDatasets() {
    var input, filter, datasetsList, datasetItems, a, i, txtValue;
    input = document.getElementById('search-bar');
    filter = input.value.toLowerCase();
    datasetsList = document.getElementById("datasets-list");
    datasetItems = datasetsList.getElementsByClassName('dataset-item');

    for (i = 0; i < datasetItems.length; i++) {
      a = datasetItems[i].getElementsByTagName("a")[0];
      txtValue = a.textContent || a.innerText;
      if (txtValue.toLowerCase().indexOf(filter) > -1) {
        datasetItems[i].style.display = "";
      } else {
        datasetItems[i].style.display = "none";
      }
    }
  }


  function refreshPage() {
  location.href = location.href; 
  } 


function closeModalIfEmpty(refreshPageFlag) {
  if (counter === 0) {
    var modalOverlay = document.querySelector(".modal-overlay");
    modalOverlay.style.display = "none";
    updatePartialView(); // Refresh the modal content after hiding the overlay
    if (refreshPageFlag) {
      refreshPage();
    }
  }
}


  function deleteDataset(id) {
    var deleted = 0;

    var confirmDelete = confirm("Are you sure you want to delete this dataset?")

    if (confirmDelete){

    fetch('/idra_delete', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector("meta[name=csrf-token]").content
      },
      body: JSON.stringify({ selected_dataset_id: id })
    })
    .then(response => {
      if (response.ok) {
        updatePartialView();
        counter--;
       const deleteEvent = new CustomEvent('datasetDeleted', { detail: { deleted: deleted } });
        document.dispatchEvent(deleteEvent);
        closeModalIfEmpty(true)
        
      } else {
        // Handle errors if needed
      }
    })
    .catch(error => {
      // Handle errors if needed
    });
    }

    
  }
</script>