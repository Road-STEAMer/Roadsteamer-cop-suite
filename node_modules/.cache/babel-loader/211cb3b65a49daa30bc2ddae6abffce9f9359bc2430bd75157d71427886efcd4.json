{"ast":null,"code":"function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction _callSuper(t, o, e) {\n  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e));\n}\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return _assertThisInitialized(t);\n}\nfunction _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nfunction _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (_isNativeReflectConstruct = function _isNativeReflectConstruct() {\n    return !!t;\n  })();\n}\nfunction _get() {\n  return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) {\n    var p = _superPropBase(e, t);\n    if (p) {\n      var n = Object.getOwnPropertyDescriptor(p, t);\n      return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value;\n    }\n  }, _get.apply(null, arguments);\n}\nfunction _superPropBase(t, o) {\n  for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t)););\n  return t;\n}\nfunction _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: !0,\n      configurable: !0\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: !1\n  }), e && _setPrototypeOf(t, e);\n}\nfunction _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nimport * as L from \"leaflet\";\nimport Controller from \"src/decidim/decidim_awesome/awesome_map/controllers/controller\";\nimport ProposalsFetcher from \"src/decidim/decidim_awesome/awesome_map/api/proposals_fetcher\";\nvar ProposalIcon = L.DivIcon.SVGIcon.DecidimIcon.extend({\n  options: {\n    fillColor: \"#ef604d\",\n    fillOpacity: 0.8,\n    strokeWidth: 1,\n    strokeOpcacity: 1\n  }\n});\nvar ProposalsController = /*#__PURE__*/function (_Controller) {\n  function ProposalsController(awesomeMap, component) {\n    var _this;\n    _classCallCheck(this, ProposalsController);\n    _this = _callSuper(this, ProposalsController, [awesomeMap, component]);\n    _this.templateId = \"marker-proposal-popup\";\n    _this.amendments = {};\n    _this.setFetcher(ProposalsFetcher);\n    return _this;\n  }\n  _inherits(ProposalsController, _Controller);\n  return _createClass(ProposalsController, [{\n    key: \"addControls\",\n    value: function addControls() {\n      _get(_getPrototypeOf(ProposalsController.prototype), \"addControls\", this).call(this);\n\n      // add control layer for amendments if any\n      if (this.awesomeMap.config.menu.amendments && this.component.amendments && !this.awesomeMap.layers.amendments) {\n        this.awesomeMap.layers.amendments = {\n          label: \"<span class=\\\"awesome_map-component\\\" id=\\\"awesome_map-amendments_\".concat(this.component.id, \"\\\" title=\\\"0\\\" data-layer=\\\"amendments\\\">\").concat(window.DecidimAwesome.texts.amendments, \"</span>\"),\n          group: new L.FeatureGroup.SubGroup(this.awesomeMap.cluster)\n        };\n        this.awesomeMap.controls.main.addOverlay(this.awesomeMap.layers.amendments.group, this.awesomeMap.layers.amendments.label);\n        this.awesomeMap.layers.amendments.group.addTo(this.awesomeMap.map);\n      }\n    }\n  }, {\n    key: \"loadNodes\",\n    value: function loadNodes() {\n      var _this2 = this;\n      // for each proposal, create a marker with an associated popup\n      this.fetcher.onNode = function (proposal) {\n        var marker = new L.Marker([proposal.coordinates.latitude, proposal.coordinates.longitude], {\n          icon: _this2.createIcon(ProposalIcon, _this2.awesomeMap.getCategory(proposal.category).color),\n          title: proposal.title.translation\n        });\n\n        // Check if it has amendments, add it to a list\n        // also assign parent's proposal categories to it\n        if (proposal.amendments && proposal.amendments.length) {\n          proposal.amendments.forEach(function (amendment) {\n            _this2.amendments[amendment.emendation.id] = proposal;\n          });\n        }\n\n        // console.log(\"new proposal\", proposal, \"marker\",  marker)\n        _this2.addMarker(marker, proposal);\n      };\n      this.fetcher.fetch();\n    }\n  }, {\n    key: \"_onFinished\",\n    value: function _onFinished() {\n      var _this3 = this;\n      var iterableAmendments = Object.entries(this.amendments);\n      this.awesomeMap.controls.updateStats(\"component_\".concat(this.component.id), this.allNodes.length - iterableAmendments.length);\n      this.awesomeMap.controls.updateStats(\"amendments_\".concat(this.component.id), iterableAmendments.length);\n\n      // Process all amendments\n      iterableAmendments.forEach(function (amendment) {\n        var marker = _this3.allNodes.find(function (node) {\n          return node.id === amendment[0];\n        });\n        var parent = amendment[1];\n        // console.log(\"marker\", marker, \"parent proposal\", parent)\n        // add marker to amendments layers and remove it from proposals\n        if (marker) {\n          try {\n            marker.marker.removeFrom(_this3.controls.group);\n          } catch (evt) {\n            console.error(\"error removeFrom marker\", marker, \"layer\", _this3.controls.group, evt);\n          }\n          if (_this3.awesomeMap.config.menu.amendments) {\n            marker.marker.addTo(_this3.awesomeMap.layers.amendments.group);\n            // mimic parent category (amendments doesn't have categories)\n            if (parent.category) {\n              marker.marker.setIcon(_this3.createIcon(ProposalIcon, _this3.awesomeMap.getCategory(parent.category).color));\n              _this3.addMarkerCategory(marker.marker, parent.category);\n            }\n          }\n        }\n      });\n      this.onFinished();\n    }\n  }]);\n}(Controller);\nexport { ProposalsController as default };","map":{"version":3,"names":["L","Controller","ProposalsFetcher","ProposalIcon","DivIcon","SVGIcon","DecidimIcon","extend","options","fillColor","fillOpacity","strokeWidth","strokeOpcacity","ProposalsController","_Controller","awesomeMap","component","_this","_classCallCheck","_callSuper","templateId","amendments","setFetcher","_inherits","_createClass","key","value","addControls","_get","_getPrototypeOf","prototype","call","config","menu","layers","label","concat","id","window","DecidimAwesome","texts","group","FeatureGroup","SubGroup","cluster","controls","main","addOverlay","addTo","map","loadNodes","_this2","fetcher","onNode","proposal","marker","Marker","coordinates","latitude","longitude","icon","createIcon","getCategory","category","color","title","translation","length","forEach","amendment","emendation","addMarker","fetch","_onFinished","_this3","iterableAmendments","Object","entries","updateStats","allNodes","find","node","parent","removeFrom","evt","console","error","setIcon","addMarkerCategory","onFinished","default"],"sources":["/home/daniele/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-decidim_awesome-0.10.2/app/packs/src/decidim/decidim_awesome/awesome_map/controllers/proposals_controller.js"],"sourcesContent":["import * as L from \"leaflet\";\nimport Controller from \"src/decidim/decidim_awesome/awesome_map/controllers/controller\";\nimport ProposalsFetcher from \"src/decidim/decidim_awesome/awesome_map/api/proposals_fetcher\";\n\nconst ProposalIcon = L.DivIcon.SVGIcon.DecidimIcon.extend({\n  options: {\n    fillColor: \"#ef604d\",\n    fillOpacity: 0.8,\n    strokeWidth: 1,\n    strokeOpcacity: 1\n  }\n});\nexport default class ProposalsController extends Controller {\n  constructor(awesomeMap, component) {\n    super(awesomeMap, component)\n    this.templateId = \"marker-proposal-popup\";\n    this.amendments = {};\n    this.setFetcher(ProposalsFetcher);\n  }\n\n  addControls() {\n    super.addControls();\n\n    // add control layer for amendments if any\n    if (this.awesomeMap.config.menu.amendments && this.component.amendments && !this.awesomeMap.layers.amendments) {\n      this.awesomeMap.layers.amendments = {\n        label: `<span class=\"awesome_map-component\" id=\"awesome_map-amendments_${this.component.id}\" title=\"0\" data-layer=\"amendments\">${window.DecidimAwesome.texts.amendments}</span>`,\n        group: new L.FeatureGroup.SubGroup(this.awesomeMap.cluster)\n      }\n      this.awesomeMap.controls.main.addOverlay(this.awesomeMap.layers.amendments.group, this.awesomeMap.layers.amendments.label);\n      this.awesomeMap.layers.amendments.group.addTo(this.awesomeMap.map);\n    }\n  }\n\n  loadNodes() {\n    // for each proposal, create a marker with an associated popup\n    this.fetcher.onNode = (proposal) => {\n      let marker = new L.Marker([proposal.coordinates.latitude, proposal.coordinates.longitude], {\n        icon: this.createIcon(ProposalIcon, this.awesomeMap.getCategory(proposal.category).color),\n        title: proposal.title.translation\n      });\n\n      // Check if it has amendments, add it to a list\n      // also assign parent's proposal categories to it\n      if (proposal.amendments && proposal.amendments.length) {\n        proposal.amendments.forEach((amendment) => {\n          this.amendments[amendment.emendation.id] = proposal;\n        });\n      }\n\n      // console.log(\"new proposal\", proposal, \"marker\",  marker)\n      this.addMarker(marker, proposal);\n    };\n\n    this.fetcher.fetch();\n  }\n\n  _onFinished() {\n    const iterableAmendments = Object.entries(this.amendments);\n    this.awesomeMap.controls.updateStats(`component_${this.component.id}`, this.allNodes.length - iterableAmendments.length);\n    this.awesomeMap.controls.updateStats(`amendments_${this.component.id}`, iterableAmendments.length);\n\n    // Process all amendments\n    iterableAmendments.forEach((amendment) => {\n      const marker = this.allNodes.find((node) => node.id === amendment[0]);\n      const parent = amendment[1];\n      // console.log(\"marker\", marker, \"parent proposal\", parent)\n      // add marker to amendments layers and remove it from proposals\n      if (marker) {\n        try { \n          marker.marker.removeFrom(this.controls.group) \n        } catch (evt) { \n          console.error(\"error removeFrom marker\", marker, \"layer\", this.controls.group,  evt);\n        }\n        if (this.awesomeMap.config.menu.amendments) {\n          marker.marker.addTo(this.awesomeMap.layers.amendments.group);\n          // mimic parent category (amendments doesn't have categories)\n          if (parent.category) {\n            marker.marker.setIcon(this.createIcon(ProposalIcon, this.awesomeMap.getCategory(parent.category).color));\n            this.addMarkerCategory(marker.marker, parent.category)\n          }\n        }\n      }\n    });\n\n    this.onFinished();\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,KAAKA,CAAC,MAAM,SAAS;AAC5B,OAAOC,UAAU,MAAM,gEAAgE;AACvF,OAAOC,gBAAgB,MAAM,+DAA+D;AAE5F,IAAMC,YAAY,GAAGH,CAAC,CAACI,OAAO,CAACC,OAAO,CAACC,WAAW,CAACC,MAAM,CAAC;EACxDC,OAAO,EAAE;IACPC,SAAS,EAAE,SAAS;IACpBC,WAAW,EAAE,GAAG;IAChBC,WAAW,EAAE,CAAC;IACdC,cAAc,EAAE;EAClB;AACF,CAAC,CAAC;AAAC,IACkBC,mBAAmB,0BAAAC,WAAA;EACtC,SAAAD,oBAAYE,UAAU,EAAEC,SAAS,EAAE;IAAA,IAAAC,KAAA;IAAAC,eAAA,OAAAL,mBAAA;IACjCI,KAAA,GAAAE,UAAA,OAAAN,mBAAA,GAAME,UAAU,EAAEC,SAAS;IAC3BC,KAAA,CAAKG,UAAU,GAAG,uBAAuB;IACzCH,KAAA,CAAKI,UAAU,GAAG,CAAC,CAAC;IACpBJ,KAAA,CAAKK,UAAU,CAACpB,gBAAgB,CAAC;IAAC,OAAAe,KAAA;EACpC;EAACM,SAAA,CAAAV,mBAAA,EAAAC,WAAA;EAAA,OAAAU,YAAA,CAAAX,mBAAA;IAAAY,GAAA;IAAAC,KAAA,EAED,SAAAC,YAAA,EAAc;MACZC,IAAA,CAAAC,eAAA,CAAAhB,mBAAA,CAAAiB,SAAA,wBAAAC,IAAA;;MAEA;MACA,IAAI,IAAI,CAAChB,UAAU,CAACiB,MAAM,CAACC,IAAI,CAACZ,UAAU,IAAI,IAAI,CAACL,SAAS,CAACK,UAAU,IAAI,CAAC,IAAI,CAACN,UAAU,CAACmB,MAAM,CAACb,UAAU,EAAE;QAC7G,IAAI,CAACN,UAAU,CAACmB,MAAM,CAACb,UAAU,GAAG;UAClCc,KAAK,uEAAAC,MAAA,CAAoE,IAAI,CAACpB,SAAS,CAACqB,EAAE,+CAAAD,MAAA,CAAuCE,MAAM,CAACC,cAAc,CAACC,KAAK,CAACnB,UAAU,YAAS;UAChLoB,KAAK,EAAE,IAAIzC,CAAC,CAAC0C,YAAY,CAACC,QAAQ,CAAC,IAAI,CAAC5B,UAAU,CAAC6B,OAAO;QAC5D,CAAC;QACD,IAAI,CAAC7B,UAAU,CAAC8B,QAAQ,CAACC,IAAI,CAACC,UAAU,CAAC,IAAI,CAAChC,UAAU,CAACmB,MAAM,CAACb,UAAU,CAACoB,KAAK,EAAE,IAAI,CAAC1B,UAAU,CAACmB,MAAM,CAACb,UAAU,CAACc,KAAK,CAAC;QAC1H,IAAI,CAACpB,UAAU,CAACmB,MAAM,CAACb,UAAU,CAACoB,KAAK,CAACO,KAAK,CAAC,IAAI,CAACjC,UAAU,CAACkC,GAAG,CAAC;MACpE;IACF;EAAC;IAAAxB,GAAA;IAAAC,KAAA,EAED,SAAAwB,UAAA,EAAY;MAAA,IAAAC,MAAA;MACV;MACA,IAAI,CAACC,OAAO,CAACC,MAAM,GAAG,UAACC,QAAQ,EAAK;QAClC,IAAIC,MAAM,GAAG,IAAIvD,CAAC,CAACwD,MAAM,CAAC,CAACF,QAAQ,CAACG,WAAW,CAACC,QAAQ,EAAEJ,QAAQ,CAACG,WAAW,CAACE,SAAS,CAAC,EAAE;UACzFC,IAAI,EAAET,MAAI,CAACU,UAAU,CAAC1D,YAAY,EAAEgD,MAAI,CAACpC,UAAU,CAAC+C,WAAW,CAACR,QAAQ,CAACS,QAAQ,CAAC,CAACC,KAAK,CAAC;UACzFC,KAAK,EAAEX,QAAQ,CAACW,KAAK,CAACC;QACxB,CAAC,CAAC;;QAEF;QACA;QACA,IAAIZ,QAAQ,CAACjC,UAAU,IAAIiC,QAAQ,CAACjC,UAAU,CAAC8C,MAAM,EAAE;UACrDb,QAAQ,CAACjC,UAAU,CAAC+C,OAAO,CAAC,UAACC,SAAS,EAAK;YACzClB,MAAI,CAAC9B,UAAU,CAACgD,SAAS,CAACC,UAAU,CAACjC,EAAE,CAAC,GAAGiB,QAAQ;UACrD,CAAC,CAAC;QACJ;;QAEA;QACAH,MAAI,CAACoB,SAAS,CAAChB,MAAM,EAAED,QAAQ,CAAC;MAClC,CAAC;MAED,IAAI,CAACF,OAAO,CAACoB,KAAK,CAAC,CAAC;IACtB;EAAC;IAAA/C,GAAA;IAAAC,KAAA,EAED,SAAA+C,YAAA,EAAc;MAAA,IAAAC,MAAA;MACZ,IAAMC,kBAAkB,GAAGC,MAAM,CAACC,OAAO,CAAC,IAAI,CAACxD,UAAU,CAAC;MAC1D,IAAI,CAACN,UAAU,CAAC8B,QAAQ,CAACiC,WAAW,cAAA1C,MAAA,CAAc,IAAI,CAACpB,SAAS,CAACqB,EAAE,GAAI,IAAI,CAAC0C,QAAQ,CAACZ,MAAM,GAAGQ,kBAAkB,CAACR,MAAM,CAAC;MACxH,IAAI,CAACpD,UAAU,CAAC8B,QAAQ,CAACiC,WAAW,eAAA1C,MAAA,CAAe,IAAI,CAACpB,SAAS,CAACqB,EAAE,GAAIsC,kBAAkB,CAACR,MAAM,CAAC;;MAElG;MACAQ,kBAAkB,CAACP,OAAO,CAAC,UAACC,SAAS,EAAK;QACxC,IAAMd,MAAM,GAAGmB,MAAI,CAACK,QAAQ,CAACC,IAAI,CAAC,UAACC,IAAI;UAAA,OAAKA,IAAI,CAAC5C,EAAE,KAAKgC,SAAS,CAAC,CAAC,CAAC;QAAA,EAAC;QACrE,IAAMa,MAAM,GAAGb,SAAS,CAAC,CAAC,CAAC;QAC3B;QACA;QACA,IAAId,MAAM,EAAE;UACV,IAAI;YACFA,MAAM,CAACA,MAAM,CAAC4B,UAAU,CAACT,MAAI,CAAC7B,QAAQ,CAACJ,KAAK,CAAC;UAC/C,CAAC,CAAC,OAAO2C,GAAG,EAAE;YACZC,OAAO,CAACC,KAAK,CAAC,yBAAyB,EAAE/B,MAAM,EAAE,OAAO,EAAEmB,MAAI,CAAC7B,QAAQ,CAACJ,KAAK,EAAG2C,GAAG,CAAC;UACtF;UACA,IAAIV,MAAI,CAAC3D,UAAU,CAACiB,MAAM,CAACC,IAAI,CAACZ,UAAU,EAAE;YAC1CkC,MAAM,CAACA,MAAM,CAACP,KAAK,CAAC0B,MAAI,CAAC3D,UAAU,CAACmB,MAAM,CAACb,UAAU,CAACoB,KAAK,CAAC;YAC5D;YACA,IAAIyC,MAAM,CAACnB,QAAQ,EAAE;cACnBR,MAAM,CAACA,MAAM,CAACgC,OAAO,CAACb,MAAI,CAACb,UAAU,CAAC1D,YAAY,EAAEuE,MAAI,CAAC3D,UAAU,CAAC+C,WAAW,CAACoB,MAAM,CAACnB,QAAQ,CAAC,CAACC,KAAK,CAAC,CAAC;cACxGU,MAAI,CAACc,iBAAiB,CAACjC,MAAM,CAACA,MAAM,EAAE2B,MAAM,CAACnB,QAAQ,CAAC;YACxD;UACF;QACF;MACF,CAAC,CAAC;MAEF,IAAI,CAAC0B,UAAU,CAAC,CAAC;IACnB;EAAC;AAAA,EA1E8CxF,UAAU;AAAA,SAAtCY,mBAAmB,IAAA6E,OAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}