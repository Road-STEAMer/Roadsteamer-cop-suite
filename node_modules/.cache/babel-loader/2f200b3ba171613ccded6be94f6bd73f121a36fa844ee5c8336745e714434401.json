{"ast":null,"code":"$(function () {\n  var CustomFieldsBuilders = window.CustomFieldsBuilders || [];\n  $(\"body\").on(\"click\", \"a.awesome-auto-edit\", function (ev) {\n    ev.preventDefault();\n    var $link = $(ev.currentTarget);\n    var scope = $link.data(\"scope\");\n    var $target = $(\"span.awesome-auto-edit[data-scope=\\\"\".concat(scope, \"\\\"]\"));\n    var $constraints = $(\".constraints-editor[data-key=\\\"\".concat(scope, \"\\\"]\"));\n    if ($target.length === 0) {\n      return;\n    }\n    var key = $target.data(\"key\");\n    var attribute = $target.data(\"var\");\n    var $hidden = $(\"[name=\\\"config[\".concat(attribute, \"][\").concat(key, \"]\\\"]\"));\n    var $multiple = $(\"[name=\\\"config[\".concat(attribute, \"][\").concat(key, \"][]\\\"]\"));\n    var $container = $(\".\".concat(attribute, \"_container[data-key=\\\"\").concat(key, \"\\\"]\"));\n    var $delete = $(\".delete-box\", $container);\n    var rebuildLabel = function rebuildLabel(text, withScope) {\n      $target.text(text);\n      $target.attr(\"data-key\", text);\n      $target.data(\"key\", text);\n      if (withScope) {\n        $target.attr(\"data-scope\", withScope);\n        $target.data(\"scope\", withScope);\n        $link.attr(\"data-scope\", withScope);\n        $link.data(\"scope\", withScope);\n      }\n      $link.show();\n    };\n    var rebuildHmtl = function rebuildHmtl(result) {\n      rebuildLabel(result.key, result.scope);\n      $constraints.replaceWith(result.html);\n      // update hidden input if exists\n      $hidden.attr(\"name\", \"config[\".concat(attribute, \"][\").concat(result.key, \"]\"));\n      $multiple.attr(\"name\", \"config[\".concat(attribute, \"][\").concat(result.key, \"][]\"));\n      $container.data(\"key\", result.key);\n      $container.attr(\"data-key\", result.key);\n      $delete.attr(\"href\", $delete.attr(\"href\").replace(\"key=\".concat(key), \"key=\".concat(result.key)));\n      CustomFieldsBuilders.forEach(function (builder) {\n        if (builder.key === key) {\n          builder.key = result.key;\n        }\n      });\n    };\n    $target.html(\"<input class=\\\"awesome-auto-edit\\\" data-scope=\\\"\".concat(scope, \"\\\" type=\\\"text\\\" value=\\\"\").concat(key, \"\\\">\"));\n    var $input = $(\"input.awesome-auto-edit[data-scope=\\\"\".concat(scope, \"\\\"]\"));\n    $link.hide();\n    $input.select();\n    $input.on(\"keypress\", function (evt) {\n      if (evt.code === \"Enter\" || evt.code === \"13\" || evt.code === \"10\") {\n        evt.preventDefault();\n        $.ajax({\n          type: \"POST\",\n          url: window.DecidimAwesome.rename_scope_label_path,\n          dataType: \"json\",\n          headers: {\n            \"X-CSRF-Token\": $(\"meta[name=csrf-token]\").attr(\"content\")\n          },\n          data: {\n            key: key,\n            scope: scope,\n            attribute: attribute,\n            text: $input.val()\n          }\n        }).done(function (result) {\n          return rebuildHmtl(result);\n        }).fail(function (err) {\n          console.error(\"Error saving key\", key, \"ERR:\", err);\n          rebuildLabel(key);\n        });\n      }\n    });\n    $input.on(\"blur\", function () {\n      rebuildLabel(key);\n    });\n  });\n});","map":{"version":3,"names":["$","CustomFieldsBuilders","window","on","ev","preventDefault","$link","currentTarget","scope","data","$target","concat","$constraints","length","key","attribute","$hidden","$multiple","$container","$delete","rebuildLabel","text","withScope","attr","show","rebuildHmtl","result","replaceWith","html","replace","forEach","builder","$input","hide","select","evt","code","ajax","type","url","DecidimAwesome","rename_scope_label_path","dataType","headers","val","done","fail","err","console","error"],"sources":["/home/daniele/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-decidim_awesome-0.10.2/app/packs/src/decidim/decidim_awesome/admin/auto_edit.js"],"sourcesContent":["$(() => {\n  let CustomFieldsBuilders = window.CustomFieldsBuilders || [];\n\n  $(\"body\").on(\"click\", \"a.awesome-auto-edit\", (ev) => {\n    ev.preventDefault();\n    const $link = $(ev.currentTarget);\n    const scope = $link.data(\"scope\");\n    const $target = $(`span.awesome-auto-edit[data-scope=\"${scope}\"]`);\n    const $constraints = $(`.constraints-editor[data-key=\"${scope}\"]`);\n    if ($target.length === 0) {\n      return;\n    }\n\n    const key = $target.data(\"key\");\n    const attribute = $target.data(\"var\");\n    const $hidden = $(`[name=\"config[${attribute}][${key}]\"]`);\n    const $multiple = $(`[name=\"config[${attribute}][${key}][]\"]`);\n    const $container = $(`.${attribute}_container[data-key=\"${key}\"]`);\n    const $delete = $(\".delete-box\", $container);\n\n    const rebuildLabel = (text, withScope) => {\n      $target.text(text);\n      $target.attr(\"data-key\", text);\n      $target.data(\"key\", text);\n      if (withScope) {\n        $target.attr(\"data-scope\", withScope);\n        $target.data(\"scope\", withScope);\n        $link.attr(\"data-scope\", withScope);\n        $link.data(\"scope\", withScope);\n      }\n      $link.show();\n    };\n\n    const rebuildHmtl = (result) => {\n      rebuildLabel(result.key, result.scope);\n      $constraints.replaceWith(result.html);\n      // update hidden input if exists\n      $hidden.attr(\"name\", `config[${attribute}][${result.key}]`);\n      $multiple.attr(\"name\", `config[${attribute}][${result.key}][]`);\n      $container.data(\"key\", result.key);\n      $container.attr(\"data-key\", result.key);\n      $delete.attr(\"href\", $delete.attr(\"href\").replace(`key=${key}`, `key=${result.key}`))\n      CustomFieldsBuilders.forEach((builder) => {\n        if (builder.key === key) {\n          builder.key = result.key;\n        }\n      });\n    };\n\n    $target.html(`<input class=\"awesome-auto-edit\" data-scope=\"${scope}\" type=\"text\" value=\"${key}\">`);\n    const $input = $(`input.awesome-auto-edit[data-scope=\"${scope}\"]`);\n    $link.hide();\n    $input.select();\n    $input.on(\"keypress\", (evt) => {\n      if (evt.code === \"Enter\" || evt.code === \"13\" || evt.code === \"10\") {\n        evt.preventDefault();\n        $.ajax(\n          {\n            type: \"POST\",\n            url: window.DecidimAwesome.rename_scope_label_path,\n            dataType: \"json\",\n            headers: {\n              \"X-CSRF-Token\": $(\"meta[name=csrf-token]\").attr(\"content\")\n            },\n            data: { key: key,\n              scope: scope,\n              attribute: attribute,\n              text: $input.val()\n            }\n          }).\n          done((result) => rebuildHmtl(result)).\n          fail((err) => {\n            console.error(\"Error saving key\", key, \"ERR:\", err);\n            rebuildLabel(key);\n          });\n      }\n    });\n    $input.on(\"blur\", () => {\n      rebuildLabel(key);\n    });\n  });\n});\n"],"mappings":"AAAAA,CAAC,CAAC,YAAM;EACN,IAAIC,oBAAoB,GAAGC,MAAM,CAACD,oBAAoB,IAAI,EAAE;EAE5DD,CAAC,CAAC,MAAM,CAAC,CAACG,EAAE,CAAC,OAAO,EAAE,qBAAqB,EAAE,UAACC,EAAE,EAAK;IACnDA,EAAE,CAACC,cAAc,EAAE;IACnB,IAAMC,KAAK,GAAGN,CAAC,CAACI,EAAE,CAACG,aAAa,CAAC;IACjC,IAAMC,KAAK,GAAGF,KAAK,CAACG,IAAI,CAAC,OAAO,CAAC;IACjC,IAAMC,OAAO,GAAGV,CAAC,wCAAAW,MAAA,CAAuCH,KAAK,SAAK;IAClE,IAAMI,YAAY,GAAGZ,CAAC,mCAAAW,MAAA,CAAkCH,KAAK,SAAK;IAClE,IAAIE,OAAO,CAACG,MAAM,KAAK,CAAC,EAAE;MACxB;IACF;IAEA,IAAMC,GAAG,GAAGJ,OAAO,CAACD,IAAI,CAAC,KAAK,CAAC;IAC/B,IAAMM,SAAS,GAAGL,OAAO,CAACD,IAAI,CAAC,KAAK,CAAC;IACrC,IAAMO,OAAO,GAAGhB,CAAC,mBAAAW,MAAA,CAAkBI,SAAS,QAAAJ,MAAA,CAAKG,GAAG,UAAM;IAC1D,IAAMG,SAAS,GAAGjB,CAAC,mBAAAW,MAAA,CAAkBI,SAAS,QAAAJ,MAAA,CAAKG,GAAG,YAAQ;IAC9D,IAAMI,UAAU,GAAGlB,CAAC,KAAAW,MAAA,CAAKI,SAAS,4BAAAJ,MAAA,CAAwBG,GAAG,SAAK;IAClE,IAAMK,OAAO,GAAGnB,CAAC,CAAC,aAAa,EAAEkB,UAAU,CAAC;IAE5C,IAAME,YAAY,GAAG,SAAfA,YAAYA,CAAIC,IAAI,EAAEC,SAAS,EAAK;MACxCZ,OAAO,CAACW,IAAI,CAACA,IAAI,CAAC;MAClBX,OAAO,CAACa,IAAI,CAAC,UAAU,EAAEF,IAAI,CAAC;MAC9BX,OAAO,CAACD,IAAI,CAAC,KAAK,EAAEY,IAAI,CAAC;MACzB,IAAIC,SAAS,EAAE;QACbZ,OAAO,CAACa,IAAI,CAAC,YAAY,EAAED,SAAS,CAAC;QACrCZ,OAAO,CAACD,IAAI,CAAC,OAAO,EAAEa,SAAS,CAAC;QAChChB,KAAK,CAACiB,IAAI,CAAC,YAAY,EAAED,SAAS,CAAC;QACnChB,KAAK,CAACG,IAAI,CAAC,OAAO,EAAEa,SAAS,CAAC;MAChC;MACAhB,KAAK,CAACkB,IAAI,EAAE;IACd,CAAC;IAED,IAAMC,WAAW,GAAG,SAAdA,WAAWA,CAAIC,MAAM,EAAK;MAC9BN,YAAY,CAACM,MAAM,CAACZ,GAAG,EAAEY,MAAM,CAAClB,KAAK,CAAC;MACtCI,YAAY,CAACe,WAAW,CAACD,MAAM,CAACE,IAAI,CAAC;MACrC;MACAZ,OAAO,CAACO,IAAI,CAAC,MAAM,YAAAZ,MAAA,CAAYI,SAAS,QAAAJ,MAAA,CAAKe,MAAM,CAACZ,GAAG,OAAI;MAC3DG,SAAS,CAACM,IAAI,CAAC,MAAM,YAAAZ,MAAA,CAAYI,SAAS,QAAAJ,MAAA,CAAKe,MAAM,CAACZ,GAAG,SAAM;MAC/DI,UAAU,CAACT,IAAI,CAAC,KAAK,EAAEiB,MAAM,CAACZ,GAAG,CAAC;MAClCI,UAAU,CAACK,IAAI,CAAC,UAAU,EAAEG,MAAM,CAACZ,GAAG,CAAC;MACvCK,OAAO,CAACI,IAAI,CAAC,MAAM,EAAEJ,OAAO,CAACI,IAAI,CAAC,MAAM,CAAC,CAACM,OAAO,QAAAlB,MAAA,CAAQG,GAAG,UAAAH,MAAA,CAAWe,MAAM,CAACZ,GAAG,EAAG,CAAC;MACrFb,oBAAoB,CAAC6B,OAAO,CAAC,UAACC,OAAO,EAAK;QACxC,IAAIA,OAAO,CAACjB,GAAG,KAAKA,GAAG,EAAE;UACvBiB,OAAO,CAACjB,GAAG,GAAGY,MAAM,CAACZ,GAAG;QAC1B;MACF,CAAC,CAAC;IACJ,CAAC;IAEDJ,OAAO,CAACkB,IAAI,oDAAAjB,MAAA,CAAiDH,KAAK,+BAAAG,MAAA,CAAwBG,GAAG,SAAK;IAClG,IAAMkB,MAAM,GAAGhC,CAAC,yCAAAW,MAAA,CAAwCH,KAAK,SAAK;IAClEF,KAAK,CAAC2B,IAAI,EAAE;IACZD,MAAM,CAACE,MAAM,EAAE;IACfF,MAAM,CAAC7B,EAAE,CAAC,UAAU,EAAE,UAACgC,GAAG,EAAK;MAC7B,IAAIA,GAAG,CAACC,IAAI,KAAK,OAAO,IAAID,GAAG,CAACC,IAAI,KAAK,IAAI,IAAID,GAAG,CAACC,IAAI,KAAK,IAAI,EAAE;QAClED,GAAG,CAAC9B,cAAc,EAAE;QACpBL,CAAC,CAACqC,IAAI,CACJ;UACEC,IAAI,EAAE,MAAM;UACZC,GAAG,EAAErC,MAAM,CAACsC,cAAc,CAACC,uBAAuB;UAClDC,QAAQ,EAAE,MAAM;UAChBC,OAAO,EAAE;YACP,cAAc,EAAE3C,CAAC,CAAC,uBAAuB,CAAC,CAACuB,IAAI,CAAC,SAAS;UAC3D,CAAC;UACDd,IAAI,EAAE;YAAEK,GAAG,EAAEA,GAAG;YACdN,KAAK,EAAEA,KAAK;YACZO,SAAS,EAAEA,SAAS;YACpBM,IAAI,EAAEW,MAAM,CAACY,GAAG;UAClB;QACF,CAAC,CAAC,CACFC,IAAI,CAAC,UAACnB,MAAM;UAAA,OAAKD,WAAW,CAACC,MAAM,CAAC;QAAA,EAAC,CACrCoB,IAAI,CAAC,UAACC,GAAG,EAAK;UACZC,OAAO,CAACC,KAAK,CAAC,kBAAkB,EAAEnC,GAAG,EAAE,MAAM,EAAEiC,GAAG,CAAC;UACnD3B,YAAY,CAACN,GAAG,CAAC;QACnB,CAAC,CAAC;MACN;IACF,CAAC,CAAC;IACFkB,MAAM,CAAC7B,EAAE,CAAC,MAAM,EAAE,YAAM;MACtBiB,YAAY,CAACN,GAAG,CAAC;IACnB,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}