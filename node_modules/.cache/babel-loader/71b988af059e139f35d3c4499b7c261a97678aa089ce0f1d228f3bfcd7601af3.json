{"ast":null,"code":"function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction _callSuper(t, o, e) {\n  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e));\n}\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return _assertThisInitialized(t);\n}\nfunction _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nfunction _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (_isNativeReflectConstruct = function _isNativeReflectConstruct() {\n    return !!t;\n  })();\n}\nfunction _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: !0,\n      configurable: !0\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: !1\n  }), e && _setPrototypeOf(t, e);\n}\nfunction _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nimport \"src/decidim/vendor/jquery-tmpl\";\nimport * as L from \"leaflet\";\nimport MapController from \"src/decidim/map/controller\";\nimport \"leaflet.markercluster\";\nvar MapMarkersController = /*#__PURE__*/function (_MapController) {\n  function MapMarkersController() {\n    _classCallCheck(this, MapMarkersController);\n    return _callSuper(this, MapMarkersController, arguments);\n  }\n  _inherits(MapMarkersController, _MapController);\n  return _createClass(MapMarkersController, [{\n    key: \"start\",\n    value: function start() {\n      this.markerClusters = null;\n      if (Array.isArray(this.config.markers) && this.config.markers.length > 0) {\n        this.addMarkers(this.config.markers);\n      } else {\n        this.map.fitWorld();\n      }\n    }\n  }, {\n    key: \"addMarkers\",\n    value: function addMarkers(markersData) {\n      var _this = this;\n      if (this.markerClusters === null) {\n        this.markerClusters = new L.MarkerClusterGroup();\n        this.map.addLayer(this.markerClusters);\n      }\n\n      // Pre-compiles the template\n      $.template(this.config.popupTemplateId, $(\"#\".concat(this.config.popupTemplateId)).html());\n      var bounds = new L.LatLngBounds(markersData.map(function (markerData) {\n        return [markerData.latitude, markerData.longitude];\n      }));\n      markersData.forEach(function (markerData) {\n        var marker = new L.Marker([markerData.latitude, markerData.longitude], {\n          icon: _this.createIcon(),\n          keyboard: true,\n          title: markerData.title\n        });\n        var node = document.createElement(\"div\");\n        $.tmpl(_this.config.popupTemplateId, markerData).appendTo(node);\n        marker.bindPopup(node, {\n          maxwidth: 640,\n          minWidth: 500,\n          keepInView: true,\n          className: \"map-info\"\n        }).openPopup();\n        _this.markerClusters.addLayer(marker);\n      });\n\n      // Make sure there is enough space in the map for the padding to be\n      // applied. Otherwise the map will automatically zoom out (test it on\n      // mobile). Make sure there is at least the same amount of width and\n      // height available on both sides + the padding (i.e. 4x padding in\n      // total).\n      var size = this.map.getSize();\n      if (size.y >= 400 && size.x >= 400) {\n        this.map.fitBounds(bounds, {\n          padding: [100, 100]\n        });\n      } else if (size.y >= 120 && size.x >= 120) {\n        this.map.fitBounds(bounds, {\n          padding: [30, 30]\n        });\n      } else {\n        this.map.fitBounds(bounds);\n      }\n    }\n  }, {\n    key: \"clearMarkers\",\n    value: function clearMarkers() {\n      this.map.removeLayer(this.markerClusters);\n      this.markerClusters = new L.MarkerClusterGroup();\n      this.map.addLayer(this.markerClusters);\n    }\n  }]);\n}(MapController);\nexport { MapMarkersController as default };","map":{"version":3,"names":["L","MapController","MapMarkersController","_MapController","_classCallCheck","_callSuper","arguments","_inherits","_createClass","key","value","start","markerClusters","Array","isArray","config","markers","length","addMarkers","map","fitWorld","markersData","_this","MarkerClusterGroup","addLayer","$","template","popupTemplateId","concat","html","bounds","LatLngBounds","markerData","latitude","longitude","forEach","marker","Marker","icon","createIcon","keyboard","title","node","document","createElement","tmpl","appendTo","bindPopup","maxwidth","minWidth","keepInView","className","openPopup","size","getSize","y","x","fitBounds","padding","clearMarkers","removeLayer","default"],"sources":["/home/daniele/decidim_idra/app/packs/src/decidim/map/controller/markers.js"],"sourcesContent":["import \"src/decidim/vendor/jquery-tmpl\"\nimport * as L from \"leaflet\";\nimport MapController from \"src/decidim/map/controller\"\nimport \"leaflet.markercluster\";\n\nexport default class MapMarkersController extends MapController {\n  start() {\n    this.markerClusters = null;\n\n    if (Array.isArray(this.config.markers) && this.config.markers.length > 0) {\n      this.addMarkers(this.config.markers);\n    } else {\n      this.map.fitWorld();\n    }\n  }\n\n  addMarkers(markersData) {\n    if (this.markerClusters === null) {\n      this.markerClusters = new L.MarkerClusterGroup();\n      this.map.addLayer(this.markerClusters);\n    }\n\n    // Pre-compiles the template\n    $.template(\n      this.config.popupTemplateId,\n      $(`#${this.config.popupTemplateId}`).html()\n    );\n\n    const bounds = new L.LatLngBounds(\n      markersData.map(\n        (markerData) => [markerData.latitude, markerData.longitude]\n      )\n    );\n\n    markersData.forEach((markerData) => {\n      let marker = new L.Marker([markerData.latitude, markerData.longitude], {\n        icon: this.createIcon(),\n        keyboard: true,\n        title: markerData.title\n      });\n\n      let node = document.createElement(\"div\");\n\n      $.tmpl(this.config.popupTemplateId, markerData).appendTo(node);\n      marker.bindPopup(node, {\n        maxwidth: 640,\n        minWidth: 500,\n        keepInView: true,\n        className: \"map-info\"\n      }).openPopup();\n\n      this.markerClusters.addLayer(marker);\n    });\n\n    // Make sure there is enough space in the map for the padding to be\n    // applied. Otherwise the map will automatically zoom out (test it on\n    // mobile). Make sure there is at least the same amount of width and\n    // height available on both sides + the padding (i.e. 4x padding in\n    // total).\n    const size = this.map.getSize();\n    if (size.y >= 400 && size.x >= 400) {\n      this.map.fitBounds(bounds, { padding: [100, 100] });\n    } else if (size.y >= 120 && size.x >= 120) {\n      this.map.fitBounds(bounds, { padding: [30, 30] });\n    } else {\n      this.map.fitBounds(bounds);\n    }\n  }\n\n  clearMarkers() {\n    this.map.removeLayer(this.markerClusters);\n    this.markerClusters = new L.MarkerClusterGroup();\n    this.map.addLayer(this.markerClusters);\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}