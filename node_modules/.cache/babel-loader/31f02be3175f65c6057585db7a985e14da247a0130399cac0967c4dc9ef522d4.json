{"ast":null,"code":"function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nimport * as L from \"leaflet\";\nimport \"src/decidim/map/icon\";\nimport MapControllerRegistry from \"src/decidim/map/controller_registry\";\nvar MapController = /*#__PURE__*/function () {\n  function MapController(mapId, config) {\n    _classCallCheck(this, MapController);\n    // Remove the old map if there is already one with the same ID.\n    var old = MapControllerRegistry.getController(mapId);\n    if (old) {\n      old.remove();\n    }\n    this.mapId = mapId;\n    this.config = $.extend({\n      popupTemplateId: \"marker-popup\",\n      markerColor: \"#ef604d\"\n    }, config);\n    this.map = null;\n    this.eventHandlers = {};\n    MapControllerRegistry.setController(mapId, this);\n  }\n  return _createClass(MapController, [{\n    key: \"getConfig\",\n    value: function getConfig() {\n      return this.config;\n    }\n  }, {\n    key: \"getMap\",\n    value: function getMap() {\n      return this.map;\n    }\n  }, {\n    key: \"load\",\n    value: function load() {\n      this.map = L.map(this.mapId);\n      this.map.scrollWheelZoom.disable();\n\n      // Fix the keyboard navigation on the map\n      this.map.on(\"popupopen\", function (ev) {\n        var $popup = $(ev.popup.getElement());\n        $popup.attr(\"tabindex\", 0).focus();\n      });\n      this.map.on(\"popupclose\", function (ev) {\n        $(ev.popup._source._icon).focus();\n      });\n      return this.map;\n    }\n\n    // Override this in the specific map controllers.\n  }, {\n    key: \"start\",\n    value: function start() {}\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      if (this.map) {\n        this.map.remove();\n        this.map = null;\n      }\n    }\n  }, {\n    key: \"createIcon\",\n    value: function createIcon() {\n      return new L.DivIcon.SVGIcon.DecidimIcon({\n        fillColor: this.config.markerColor,\n        iconSize: L.point(28, 36)\n      });\n    }\n  }, {\n    key: \"setEventHandler\",\n    value: function setEventHandler(name, callback) {\n      this.eventHandlers[name] = callback;\n    }\n  }, {\n    key: \"triggerEvent\",\n    value: function triggerEvent(eventName, payload) {\n      var handler = this.eventHandlers[eventName];\n      if (typeof handler === \"function\") {\n        return Reflect.apply(handler, this, payload);\n      }\n      return null;\n    }\n  }]);\n}();\nexport { MapController as default };","map":{"version":3,"names":["L","MapControllerRegistry","MapController","mapId","config","_classCallCheck","old","getController","remove","$","extend","popupTemplateId","markerColor","map","eventHandlers","setController","_createClass","key","value","getConfig","getMap","load","scrollWheelZoom","disable","on","ev","$popup","popup","getElement","attr","focus","_source","_icon","start","createIcon","DivIcon","SVGIcon","DecidimIcon","fillColor","iconSize","point","setEventHandler","name","callback","triggerEvent","eventName","payload","handler","Reflect","apply","default"],"sources":["/home/daniele/decidim_idra/app/packs/src/decidim/map/controller.js"],"sourcesContent":["import * as L from \"leaflet\";\nimport \"src/decidim/map/icon\"\nimport MapControllerRegistry from \"src/decidim/map/controller_registry\"\n\nexport default class MapController {\n  constructor(mapId, config) {\n    // Remove the old map if there is already one with the same ID.\n    const old = MapControllerRegistry.getController(mapId);\n    if (old) {\n      old.remove();\n    }\n\n    this.mapId = mapId;\n    this.config = $.extend({\n      popupTemplateId: \"marker-popup\",\n      markerColor: \"#ef604d\"\n    }, config);\n\n    this.map = null;\n    this.eventHandlers = {};\n\n    MapControllerRegistry.setController(mapId, this);\n  }\n\n  getConfig() {\n    return this.config;\n  }\n\n  getMap() {\n    return this.map;\n  }\n\n  load() {\n    this.map = L.map(this.mapId);\n\n    this.map.scrollWheelZoom.disable();\n\n    // Fix the keyboard navigation on the map\n    this.map.on(\"popupopen\", (ev) => {\n      const $popup = $(ev.popup.getElement());\n      $popup.attr(\"tabindex\", 0).focus();\n    });\n    this.map.on(\"popupclose\", (ev) => {\n      $(ev.popup._source._icon).focus();\n    });\n\n    return this.map;\n  }\n\n  // Override this in the specific map controllers.\n  start() {}\n\n  remove() {\n    if (this.map) {\n      this.map.remove();\n      this.map = null;\n    }\n  }\n\n  createIcon() {\n    return new L.DivIcon.SVGIcon.DecidimIcon({\n      fillColor: this.config.markerColor,\n      iconSize: L.point(28, 36)\n    });\n  }\n\n  setEventHandler(name, callback) {\n    this.eventHandlers[name] = callback;\n  }\n\n  triggerEvent(eventName, payload) {\n    const handler = this.eventHandlers[eventName];\n    if (typeof handler === \"function\") {\n      return Reflect.apply(handler, this, payload);\n    }\n    return null;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}