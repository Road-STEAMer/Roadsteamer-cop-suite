{"ast":null,"code":"function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nimport * as L from \"leaflet\";\n// comes with Decidim\nimport \"src/decidim/map/icon.js\";\nimport \"src/decidim/vendor/leaflet-tilelayer-here\";\n// Comes with Decidim\nimport \"leaflet.markercluster\";\n// included in this package.json\nimport \"leaflet.featuregroup.subgroup\";\nimport \"src/vendor/jquery.truncate\";\nimport \"jsrender\";\nimport ControlsUI from \"src/decidim/decidim_awesome/awesome_map/controls_ui\";\nimport ProposalsController from \"src/decidim/decidim_awesome/awesome_map/controllers/proposals_controller\";\nimport MeetingsController from \"src/decidim/decidim_awesome/awesome_map/controllers/meetings_controller\";\nvar AwesomeMap = /*#__PURE__*/function () {\n  function AwesomeMap(map, config) {\n    _classCallCheck(this, AwesomeMap);\n    this.map = map;\n    this.categories = window.AwesomeMap && window.AwesomeMap.categories || [];\n    this.config = $.extend({\n      length: 255,\n      center: null,\n      zoom: 8,\n      menu: {\n        amendments: false,\n        meetings: false,\n        categories: true,\n        hashtags: false,\n        mergeComponents: false\n      },\n      show: {\n        withdrawn: false,\n        accepted: false,\n        evaluating: false,\n        notAnswered: false,\n        rejected: false\n      },\n      hideControls: false,\n      collapsedMenu: false,\n      components: []\n    }, config);\n    this.layers = {};\n    this.cluster = new L.MarkerClusterGroup();\n    this.map.addLayer(this.cluster);\n    this.controls = new ControlsUI(this);\n    this.onFinished = function () {};\n    this.controllers = {};\n    this.loading = [];\n    this._firstController = {};\n  }\n\n  // Queries the API and load all the markers\n  return _createClass(AwesomeMap, [{\n    key: \"loadControllers\",\n    value: function loadControllers() {\n      var _this = this;\n      this.autoResize();\n      this.controls.attach();\n      this.config.components.forEach(function (component) {\n        var controller = _this._getController(component);\n        if (controller) {\n          controller.loadNodes();\n          _this.loading.push(component.type);\n          controller.onFinished = function () {\n            _this.loading.pop();\n            _this.autoResize();\n            if (_this.loading.length === 0) {\n              _this.controls.$loading.hide();\n              // call trigger as all loads are finished\n              _this.onFinished();\n            }\n          };\n        }\n      });\n    }\n  }, {\n    key: \"autoResize\",\n    value: function autoResize() {\n      // Setup center/zoom options if specified, otherwise fitbounds\n      var bounds = this.cluster.getBounds();\n      if (this.config.center && this.config.zoom) {\n        this.map.setView(this.config.center, this.config.zoom);\n      } else if (bounds.isValid()) {\n        // this.map.fitBounds(bounds, { padding: [50, 50] }); // this doesn't work much of the time, probably some race condition\n        this.map.fitBounds([[bounds.getNorth(), bounds.getEast()], [bounds.getSouth(), bounds.getWest()]], {\n          padding: [50, 50]\n        });\n      }\n    }\n  }, {\n    key: \"getCategory\",\n    value: function getCategory(category) {\n      var _this2 = this;\n      var defaultCat = {\n        color: getComputedStyle(document.documentElement).getPropertyValue(\"--primary\"),\n        children: function children() {},\n        parent: null,\n        name: null\n      };\n      if (category) {\n        var id = category.id ? parseInt(category.id, 10) : parseInt(category, 10); // eslint-disable-line no-ternary, multiline-ternary\n        var cat = this.categories.find(function (ct) {\n          return ct.id === id;\n        });\n        if (cat) {\n          cat.children = function () {\n            return _this2.categories.filter(function (ct) {\n              return ct.parent === cat.id;\n            });\n          };\n          return cat;\n        }\n      }\n      return defaultCat;\n    }\n  }, {\n    key: \"_getController\",\n    value: function _getController(component) {\n      var controller = null;\n      if (component.type === \"proposals\") {\n        controller = new ProposalsController(this, component);\n      }\n      if (component.type === \"meetings\" && this.config.menu.meetings) {\n        controller = new MeetingsController(this, component);\n      }\n      if (controller) {\n        // Agrupate layers for controlling components\n        if (this._firstController[component.type] && this.config.menu.mergeComponents) {\n          controller.controls = this._firstController[component.type].controls;\n        } else {\n          controller.addControls();\n        }\n        this._firstController[component.type] = this._firstController[component.type] || controller;\n        this.controllers[component.type] = controller;\n        return this.controllers[component.type];\n      }\n      return null;\n    }\n  }]);\n}();\nexport { AwesomeMap as default };","map":{"version":3,"names":["L","ControlsUI","ProposalsController","MeetingsController","AwesomeMap","map","config","_classCallCheck","categories","window","$","extend","length","center","zoom","menu","amendments","meetings","hashtags","mergeComponents","show","withdrawn","accepted","evaluating","notAnswered","rejected","hideControls","collapsedMenu","components","layers","cluster","MarkerClusterGroup","addLayer","controls","onFinished","controllers","loading","_firstController","_createClass","key","value","loadControllers","_this","autoResize","attach","forEach","component","controller","_getController","loadNodes","push","type","pop","$loading","hide","bounds","getBounds","setView","isValid","fitBounds","getNorth","getEast","getSouth","getWest","padding","getCategory","category","_this2","defaultCat","color","getComputedStyle","document","documentElement","getPropertyValue","children","parent","name","id","parseInt","cat","find","ct","filter","addControls","default"],"sources":["/home/daniele/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-decidim_awesome-0.10.2/app/packs/src/decidim/decidim_awesome/awesome_map/awesome_map.js"],"sourcesContent":["import * as L from \"leaflet\";\n// comes with Decidim\nimport \"src/decidim/map/icon.js\" \nimport \"src/decidim/vendor/leaflet-tilelayer-here\"\n// Comes with Decidim\nimport \"leaflet.markercluster\"; \n// included in this package.json\nimport \"leaflet.featuregroup.subgroup\" \nimport \"src/vendor/jquery.truncate\"\nimport \"jsrender\"\n\nimport ControlsUI from \"src/decidim/decidim_awesome/awesome_map/controls_ui\";\nimport ProposalsController from \"src/decidim/decidim_awesome/awesome_map/controllers/proposals_controller\";\nimport MeetingsController from \"src/decidim/decidim_awesome/awesome_map/controllers/meetings_controller\";\n\nexport default class AwesomeMap {\n  constructor(map, config) {\n    this.map = map;\n    this.categories = window.AwesomeMap && window.AwesomeMap.categories || []\n    this.config = $.extend({\n      length: 255,\n      center: null,\n      zoom: 8,\n      menu: {\n        amendments: false,\n        meetings: false,\n        categories: true,\n        hashtags: false,\n        mergeComponents: false\n      },\n      show: {\n        withdrawn: false,\n        accepted: false,\n        evaluating: false,\n        notAnswered: false,\n        rejected: false\n      },\n      hideControls: false,\n      collapsedMenu: false,\n      components: []\n    }, config);\n    this.layers = {};\n    this.cluster = new L.MarkerClusterGroup();\n    this.map.addLayer(this.cluster);\n    this.controls = new ControlsUI(this);\n    this.onFinished = () => {};\n    this.controllers = {};\n    this.loading = [];\n    this._firstController = {};\n  }\n\n  // Queries the API and load all the markers\n  loadControllers() {\n    this.autoResize();\n    this.controls.attach();\n\n    this.config.components.forEach((component) => {\n      const controller = this._getController(component);\n      if (controller) {\n        controller.loadNodes();\n        this.loading.push(component.type);\n        controller.onFinished = () => {\n          this.loading.pop();\n          this.autoResize();\n\n          if (this.loading.length === 0) {\n            this.controls.$loading.hide();\n            // call trigger as all loads are finished\n            this.onFinished();\n          }\n        };\n      }\n    });\n  }\n\n  autoResize() {\n    // Setup center/zoom options if specified, otherwise fitbounds\n    const bounds = this.cluster.getBounds()\n    if (this.config.center && this.config.zoom) {\n      this.map.setView(this.config.center, this.config.zoom);\n    } else if (bounds.isValid()) {\n      // this.map.fitBounds(bounds, { padding: [50, 50] }); // this doesn't work much of the time, probably some race condition\n      this.map.fitBounds([[bounds.getNorth(), bounds.getEast()], [bounds.getSouth(), bounds.getWest()]], { padding: [50, 50] });\n    }\n  }\n\n  getCategory(category) {\n    let defaultCat = {\n      color: getComputedStyle(document.documentElement).getPropertyValue(\"--primary\"),\n      children: () => {},\n      parent: null,\n      name: null\n    };\n\n    if (category) {\n      let id = category.id ? parseInt(category.id, 10) : parseInt(category, 10); // eslint-disable-line no-ternary, multiline-ternary\n      let cat = this.categories.find((ct) => ct.id === id);\n      if (cat) {\n        cat.children = () => {\n          return this.categories.filter((ct) => ct.parent === cat.id);\n        }\n        return cat;\n      }\n    }\n    return defaultCat;\n  }\n\n  _getController(component) {\n    let controller = null;\n\n    if (component.type === \"proposals\") {\n      controller = new ProposalsController(this, component);\n    }\n    if (component.type === \"meetings\" && this.config.menu.meetings) {\n      controller = new MeetingsController(this, component);\n    }\n\n    if (controller) {\n      // Agrupate layers for controlling components\n      if (this._firstController[component.type] && this.config.menu.mergeComponents) {\n        controller.controls = this._firstController[component.type].controls;\n      } else  {\n        controller.addControls();\n      }\n      this._firstController[component.type] = this._firstController[component.type] || controller;\n      this.controllers[component.type] = controller;\n      return this.controllers[component.type]\n    }\n    return null;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}